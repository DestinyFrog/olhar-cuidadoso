<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<div>
		<input type="text" id="input_nome"/>
		<button id="but-post">Enviar</button>
	</div>

	<h2>Lista de Alertar</h2>
	<ul id="lista-alertas"></ul>

	<script>
		const token = localStorage.getItem("token")
		const lista_alertas = document.getElementById("lista-alertas")

		fetch("/api/v1/comentario",
		{
			method: "POST",
			body: JSON.stringify({
				token
			}),
			headers: {
				"Content-Type": "application/json",
			}
		}
		)
		.then(resp => resp.json())
		.then(data => {
			data.forEach(({nome, xpos, ypos}) => {
				lista_alertas.innerHTML += `
					<li>${nome}</li>
				`
			})
		})
		.catch(err => {
			console.error(err)
		})

		const input_nome = document.getElementById("input_nome")
		const but_post = document.getElementById("but-post")		

		but_post.addEventListener("click", (ev) => {
			navigator.geolocation.getCurrentPosition((position) => {
				let xpos = position.coords.latitude
				let ypos = position.coords.longitude

				fetch("/api/v1/comentario/postar",
				{
					method: "POST",
					body: JSON.stringify({
						token,
						nome: input_nome.value,
						xpos,
						ypos
					}),
					headers: {
						"Content-Type": "application/json",
					}
				}
				)
				.then(resp => resp.json())
				.then(data => location.reload() )
				.catch(err => {
					console.error(err)
				})
			})
		})
	


	</script>
</body>
</html>